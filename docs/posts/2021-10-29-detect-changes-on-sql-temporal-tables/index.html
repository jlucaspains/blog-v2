<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Detecting changes on SQL Server Temporal Changes | Pains.net</title><meta name=keywords content><meta name=description content="SQL Server temporal tables are a great way to build data audit and to see the state of data at a point in time. However, if you want to calculate what changed over a period of time, it gets a little trickier. Keep reading to see how."><meta name=author content="Me"><link rel=canonical href=https://lpains.net/posts/2021-10-29-detect-changes-on-sql-temporal-tables/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.a55403b274160144f1f4fb29543f794f06b1561b637a7408213ef03c48b4999b.css integrity="sha256-pVQDsnQWAUTx9PspVD95TwaxVhtjenQIIT7wPEi0mZs=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.e85ad0406048e8176e1c7661b25d5c69297ddfe41dc4124cf75ecb99a4f7b3d1.js integrity="sha256-6FrQQGBI6BduHHZhsl1caSl93+QdxBJM917LmaT3s9E=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lpains.net/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lpains.net/images/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lpains.net/images/favicon-32x32.png><link rel=apple-touch-icon href="https://lpains.net/images/apple-touch=icon.png"><link rel=mask-icon href=https://lpains.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.101.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-44645930-2","auto"),ga("send","pageview"))</script><meta property="og:title" content="Detecting changes on SQL Server Temporal Changes"><meta property="og:description" content="SQL Server temporal tables are a great way to build data audit and to see the state of data at a point in time. However, if you want to calculate what changed over a period of time, it gets a little trickier. Keep reading to see how."><meta property="og:type" content="article"><meta property="og:url" content="https://lpains.net/posts/2021-10-29-detect-changes-on-sql-temporal-tables/"><meta property="og:image" content="https://lpains.net/images/posts/analog-clock.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-29T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-29T00:00:00+00:00"><meta property="og:site_name" content="Pains.net"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lpains.net/images/posts/analog-clock.jpg"><meta name=twitter:title content="Detecting changes on SQL Server Temporal Changes"><meta name=twitter:description content="SQL Server temporal tables are a great way to build data audit and to see the state of data at a point in time. However, if you want to calculate what changed over a period of time, it gets a little trickier. Keep reading to see how."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://lpains.net/posts/"},{"@type":"ListItem","position":2,"name":"Detecting changes on SQL Server Temporal Changes","item":"https://lpains.net/posts/2021-10-29-detect-changes-on-sql-temporal-tables/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Detecting changes on SQL Server Temporal Changes","name":"Detecting changes on SQL Server Temporal Changes","description":"SQL Server temporal tables are a great way to build data audit and to see the state of data at a point in time. However, if you want to calculate what changed over a period of time, it gets a little trickier. Keep reading to see how.","keywords":[],"articleBody":"SQL Server system-versioned temporal tables provide a powerful way to keep data history for a table. It provides a way to query data as of a point in time, or the changes between a time period. Check the docs for more detail.\nWhile history tables are great for many scenarios based off history data. When you need to calculate delta changes it gets a little more complicated as I am sure Temporal Tables were not designed for that purpose. In this case, delta means that over a period of time we want to get added records, changed records with calculation of differences, and deleted records.\nTo demonstrate how that works, here is a simplified example table with system versioning turned on:\n1 2 3 4 5 6 7 8 9 10 11 12 13 CREATE TABLE dbo.Orders ( Id bigint NOT NULL Identity(1,1), CustomerId bigint NOT NULL, --not really relevant for the example TotalValue decimal(18,6) NOT NULL, CONSTRAINT PK_Orders PRIMARY KEY CLUSTERED (Id), ) ALTER TABLE dbo.Orders ADD ValidFrom datetime2 GENERATED ALWAYS AS ROW START HIDDEN NOT NULL CONSTRAINT DF_Orders_ValidFrom DEFAULT (SYSUTCDATETIME()) , ValidTo datetime2 GENERATED ALWAYS AS ROW END HIDDEN NOT NULL CONSTRAINT DF_Orders_ValidTo DEFAULT ('9999-12-31 23:59:59.9999999') , PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]) ALTER TABLE dbo.Orders SET (SYSTEM_VERSIONING = ON ( HISTORY_TABLE = [dbo].[OrderHistory], HISTORY_RETENTION_PERIOD = 1 Year )) To get the wanted delta changes, we will need two dates as shown below. Note that both dates must be in UTC time zone as the ValidFrom and ValidTo columns will be saved in UTC too.\n1 2 DECLARE @DeltaStart datetime2 -- for each run, this will be the value of @DeltaEnd of the previous run DECLARE @DeltaEnd datetime2 = getutcdate() -- easier to put a limit so we know exactly what the next @DeltaStart will be Finding new and updated records is fairly straight-forward:\n1 2 3 4 5 6 7 8 -- 1. Query the current record using ValidFrom and ValidTo to detect changes -- 2. Left join to that same record as it was at the @DeltaStart, if the record was changed, updated won't be null -- 3. Get columns from the current record and calculate ValueDiff using current.TotalValue - updated.TotalValue SELECT current.Id, current.CustomerId, current.TotalValue, Status = IIF(IsNull(updated.Id, 0) = 0, 'INSERTED', 'UPDATED') , ValueDiff = current.TotalValue - IsNull(updated.TotalValue) FROM dbo.Orders current LEFT JOIN dbo.Orders for system_time as of @DeltaStart updated ON updated.Id = current.Id where current.ValidFrom \u003e @DeltaStart and current.ValidTo \u003c= @DeltaEnd Deleted records will be removed from the main system-versioned table (Orders). However, they will remain in the history table (OrderHistory). Thus, we can use the history table as the start and if the same record is not found in current table, it was deleted:\n1 2 3 4 5 6 7 -- 1. Look into history records that were closed between @DeltaStart and @DeltaEnd -- 2. Left join with current record, if the current is null, the record was deleted SELECT history.Id, history.CustomerId, history.TotalValue, Status = 'DELETED' , ValueDiff = 0 - history.TotalValue FROM dbo.OrderHistory history LEFT JOIN dbo.Orders current ON updated.Id = current.Id where ValidTo \u003e @DeltaStart and ValidTo \u003c= @DeltaEnd and current.Id is null Let’s wrap this in a procedure to make it easier to consume:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 CREATE OR ALTER PROCEDURE spGetOrderDeltaChanges (@DeltaStart datetime2, @DeltaEnd datetime2) AS BEGIN SELECT current1.Id, current1.CustomerId, current1.TotalValue, [Status] = IIF(IsNull(updated1.Id, 0) = 0, 'INSERTED', 'UPDATED') , ValueDiff = current1.TotalValue - IsNull(updated1.TotalValue, 0) FROM dbo.Orders current1 LEFT JOIN dbo.Orders for system_time as of @DeltaStart updated1 ON updated1.Id = current1.Id WHERE current1.ValidFrom \u003e @DeltaStart and current1.ValidFrom \u003c= @DeltaEnd UNION SELECT history.Id, history.CustomerId, history.TotalValue, [Status] = 'DELETED' , ValueDiff = 0 - history.TotalValue FROM dbo.OrderHistory history LEFT JOIN dbo.Orders current2 ON history.Id = current2.Id where history.ValidTo \u003e @DeltaStart and history.ValidTo \u003c= @DeltaEnd and current2.Id is null END Testing time! First, let’s add some records:\n1 2 3 4 5 6 7 8 9 10 11 12 -- for the first run, we have no way to get @DeltaStart so we just use some time before the insert DECLARE @DeltaStart datetime2 = dateadd(minute, -1, getutcdate()) INSERT INTO dbo.Orders (CustomerId, TotalValue) values (1, 100) , (2, 100) DECLARE @DeltaEnd datetime2 = getutcdate() exec spGetOrderDeltaChanges @DeltaStart, @DeltaEnd -- don't forget to store the value of @DeltaEnd for the next run Id CustomerId TotalValue ChangeType ValueDiff 1 1 100 INSERTED 100 2 2 100 INSERTED 100 This is self-explanatory, so let’s try to update record 1 and see the result:\n1 2 3 4 5 6 7 8 9 DECLARE @DeltaStart datetime2 -- get the value from @DeltaEnd from the previous run UPDATE dbo.Orders SET TotalValue = 200 WHERE Id = 1 DECLARE @DeltaEnd datetime2 = getutcdate() exec spGetOrderDeltaChanges @DeltaStart, @DeltaEnd Id CustomerId TotalValue ChangeType ValueDiff 1 1 200 UPDATED 100 Note that record 2 was not touched so it won’t show on the delta results. Also, the ValueDiff column is only 100 as TotalValue was updated from 100 to 200. Now, let’s delete record 2 and see what happens:\n1 2 3 4 5 6 7 8 DECLARE @DeltaStart datetime2 -- get the value from @DeltaEnd from the previous run DELETE dbo.Orders WHERE Id = 2 DECLARE @DeltaEnd datetime2 = getutcdate() exec spGetOrderDeltaChanges @DeltaStart, @DeltaEnd Id CustomerId TotalValue ChangeType ValueDiff 2 2 100 DELETED -100 This time, we only show the deleted record. Note that the ValueDiff will be negative as the TotalValue changed from 100 to 0 (or nothing).\nThe use cases for this is limited, but though it was not explicitly designed for this, system-versioned tables can be used to calculate delta changes of a table’s data. The changes will accumulate from @DeltaStart to @DeltaEnd so however many transactions occur over this time period in dbo.Orders will be reported when the procedure is executed.\nThat’s about it for today.\nCheers!\nLucas\n","wordCount":"973","inLanguage":"en","image":"https://lpains.net/images/posts/analog-clock.jpg","datePublished":"2021-10-29T00:00:00Z","dateModified":"2021-10-29T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lpains.net/posts/2021-10-29-detect-changes-on-sql-temporal-tables/"},"publisher":{"@type":"Organization","name":"Pains.net","logo":{"@type":"ImageObject","url":"https://lpains.net/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lpains.net/ accesskey=h title="Pains.net (Alt + H)">Pains.net</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://lpains.net/posts/ title=posts><span>posts</span></a></li><li><a href=https://lpains.net/categories/ title=categories><span>categories</span></a></li><li><a href=https://lpains.net/about/ title=about><span>about</span></a></li><li><a href=https://lpains.net/terms/ title=terms><span>terms</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lpains.net/>Home</a>&nbsp;»&nbsp;<a href=https://lpains.net/posts/>Posts</a></div><h1 class=post-title>Detecting changes on SQL Server Temporal Changes</h1><div class=post-meta>October 29, 2021&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Me</div></header><figure class=entry-cover><img loading=lazy src=https://lpains.net/images/posts/analog-clock.jpg alt=Time><p>Photo by Djim Loic on <a href=https://unsplash.com/photos/ft0-Xu4nTvA>Unsplash</a></p></figure><div class=post-content><p><a href="https://docs.microsoft.com/en-us/sql/relational-databases/tables/temporal-tables?view=sql-server-ver15">SQL Server system-versioned temporal tables</a> provide a powerful way to keep data history for a table. It provides a way to query data as of a point in time, or the changes between a time period. Check <a href="https://docs.microsoft.com/en-us/sql/relational-databases/tables/temporal-tables?view=sql-server-ver15">the docs</a> for more detail.</p><p>While history tables are great for many scenarios based off history data. When you need to calculate delta changes it gets a little more complicated as I am sure Temporal Tables were not designed for that purpose. In this case, delta means that over a period of time we want to get added records, changed records with calculation of differences, and deleted records.</p><p>To demonstrate how that works, here is a simplified example table with system versioning turned on:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Id</span><span class=w> </span><span class=nb>bigint</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>Identity</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>CustomerId</span><span class=w> </span><span class=nb>bigint</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=c1>--not really relevant for the example
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>  </span><span class=n>TotalValue</span><span class=w> </span><span class=nb>decimal</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=mi>6</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>PK_Orders</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>CLUSTERED</span><span class=w> </span><span class=p>(</span><span class=n>Id</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>ADD</span><span class=w> </span><span class=n>ValidFrom</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=k>GENERATED</span><span class=w> </span><span class=n>ALWAYS</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>ROW</span><span class=w> </span><span class=k>START</span><span class=w> </span><span class=n>HIDDEN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>DF_Orders_ValidFrom</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=p>(</span><span class=n>SYSUTCDATETIME</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>,</span><span class=w> </span><span class=n>ValidTo</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=k>GENERATED</span><span class=w> </span><span class=n>ALWAYS</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>ROW</span><span class=w> </span><span class=k>END</span><span class=w> </span><span class=n>HIDDEN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>DF_Orders_ValidTo</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;9999-12-31 23:59:59.9999999&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>,</span><span class=w> </span><span class=n>PERIOD</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=n>SYSTEM_TIME</span><span class=w> </span><span class=p>([</span><span class=n>ValidFrom</span><span class=p>],</span><span class=w> </span><span class=p>[</span><span class=n>ValidTo</span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=p>(</span><span class=n>SYSTEM_VERSIONING</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>HISTORY_TABLE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=n>dbo</span><span class=p>].[</span><span class=n>OrderHistory</span><span class=p>],</span><span class=w> </span><span class=n>HISTORY_RETENTION_PERIOD</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>Year</span><span class=w> </span><span class=p>))</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>To get the wanted delta changes, we will need two dates as shown below. Note that both dates must be in UTC time zone as the <code>ValidFrom</code> and <code>ValidTo</code> columns will be saved in UTC too.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=c1>-- for each run, this will be the value of @DeltaEnd of the previous run
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getutcdate</span><span class=p>()</span><span class=w> </span><span class=c1>-- easier to put a limit so we know exactly what the next @DeltaStart will be
</span></span></span></code></pre></td></tr></table></div></div><p>Finding new and updated records is fairly straight-forward:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 1. Query the current record using ValidFrom and ValidTo to detect changes
</span></span></span><span class=line><span class=cl><span class=c1>-- 2. Left join to that same record as it was at the @DeltaStart, if the record was changed, updated won&#39;t be null
</span></span></span><span class=line><span class=cl><span class=c1>-- 3. Get columns from the current record and calculate ValueDiff using current.TotalValue - updated.TotalValue
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>current</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span><span class=w> </span><span class=k>current</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span><span class=w> </span><span class=k>current</span><span class=p>.</span><span class=n>TotalValue</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>IIF</span><span class=p>(</span><span class=k>IsNull</span><span class=p>(</span><span class=n>updated</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;INSERTED&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;UPDATED&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=p>,</span><span class=w> </span><span class=n>ValueDiff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>current</span><span class=p>.</span><span class=n>TotalValue</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>IsNull</span><span class=p>(</span><span class=n>updated</span><span class=p>.</span><span class=n>TotalValue</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FROM</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> </span><span class=k>current</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>LEFT</span><span class=w>  </span><span class=k>JOIN</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>system_time</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=n>updated</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>updated</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>current</span><span class=p>.</span><span class=n>Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>current</span><span class=p>.</span><span class=n>ValidFrom</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>current</span><span class=p>.</span><span class=n>ValidTo</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Deleted records will be removed from the main system-versioned table (Orders). However, they will remain in the history table (OrderHistory). Thus, we can use the history table as the start and if the same record is not found in current table, it was deleted:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 1. Look into history records that were closed between @DeltaStart and @DeltaEnd
</span></span></span><span class=line><span class=cl><span class=c1>-- 2. Left join with current record, if the current is null, the record was deleted
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>TotalValue</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;DELETED&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=p>,</span><span class=w> </span><span class=n>ValueDiff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>TotalValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FROM</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>OrderHistory</span><span class=w> </span><span class=n>history</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>LEFT</span><span class=w>  </span><span class=k>JOIN</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> </span><span class=k>current</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>updated</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>current</span><span class=p>.</span><span class=n>Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>ValidTo</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>ValidTo</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>current</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=k>null</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s wrap this in a procedure to make it easier to consume:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>ALTER</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>spGetOrderDeltaChanges</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=n>datetime2</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w> </span><span class=n>datetime2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w> </span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>current1</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span><span class=w> </span><span class=n>current1</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span><span class=w> </span><span class=n>current1</span><span class=p>.</span><span class=n>TotalValue</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=n>Status</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>IIF</span><span class=p>(</span><span class=k>IsNull</span><span class=p>(</span><span class=n>updated1</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;INSERTED&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;UPDATED&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>,</span><span class=w> </span><span class=n>ValueDiff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>current1</span><span class=p>.</span><span class=n>TotalValue</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>IsNull</span><span class=p>(</span><span class=n>updated1</span><span class=p>.</span><span class=n>TotalValue</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> </span><span class=n>current1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>LEFT</span><span class=w>  </span><span class=k>JOIN</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>system_time</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=n>updated1</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>updated1</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>current1</span><span class=p>.</span><span class=n>Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>WHERE</span><span class=w> </span><span class=n>current1</span><span class=p>.</span><span class=n>ValidFrom</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>current1</span><span class=p>.</span><span class=n>ValidFrom</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>UNION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>TotalValue</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=n>Status</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;DELETED&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>,</span><span class=w> </span><span class=n>ValueDiff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>TotalValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>OrderHistory</span><span class=w> </span><span class=n>history</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>LEFT</span><span class=w>  </span><span class=k>JOIN</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> </span><span class=n>current2</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>current2</span><span class=p>.</span><span class=n>Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>where</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>ValidTo</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>history</span><span class=p>.</span><span class=n>ValidTo</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>current2</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=k>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Testing time! First, let&rsquo;s add some records:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- for the first run, we have no way to get @DeltaStart so we just use some time before the insert
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dateadd</span><span class=p>(</span><span class=k>minute</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>getutcdate</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w> </span><span class=p>(</span><span class=n>CustomerId</span><span class=p>,</span><span class=w> </span><span class=n>TotalValue</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>100</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>100</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getutcdate</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>exec</span><span class=w> </span><span class=n>spGetOrderDeltaChanges</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- don&#39;t forget to store the value of @DeltaEnd for the next run
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th>Id</th><th>CustomerId</th><th>TotalValue</th><th>ChangeType</th><th>ValueDiff</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>100</td><td>INSERTED</td><td>100</td></tr><tr><td>2</td><td>2</td><td>100</td><td>INSERTED</td><td>100</td></tr></tbody></table><p>This is self-explanatory, so let&rsquo;s try to update record 1 and see the result:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=c1>-- get the value from @DeltaEnd from the previous run
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>SET</span><span class=w> </span><span class=n>TotalValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>200</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getutcdate</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>exec</span><span class=w> </span><span class=n>spGetOrderDeltaChanges</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th>Id</th><th>CustomerId</th><th>TotalValue</th><th>ChangeType</th><th>ValueDiff</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>200</td><td>UPDATED</td><td>100</td></tr></tbody></table><p>Note that record 2 was not touched so it won&rsquo;t show on the delta results. Also, the ValueDiff column is only 100 as TotalValue was updated from 100 to 200. Now, let&rsquo;s delete record 2 and see what happens:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=c1>-- get the value from @DeltaEnd from the previous run
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELETE</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>Orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w> </span><span class=n>datetime2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getutcdate</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>exec</span><span class=w> </span><span class=n>spGetOrderDeltaChanges</span><span class=w> </span><span class=o>@</span><span class=n>DeltaStart</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>DeltaEnd</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th>Id</th><th>CustomerId</th><th>TotalValue</th><th>ChangeType</th><th>ValueDiff</th></tr></thead><tbody><tr><td>2</td><td>2</td><td>100</td><td>DELETED</td><td>-100</td></tr></tbody></table><p>This time, we only show the deleted record. Note that the ValueDiff will be negative as the TotalValue changed from 100 to 0 (or nothing).</p><p>The use cases for this is limited, but though it was not explicitly designed for this, system-versioned tables can be used to calculate delta changes of a table&rsquo;s data. The changes will accumulate from <code>@DeltaStart</code> to <code>@DeltaEnd</code> so however many transactions occur over this time period in <code>dbo.Orders</code> will be reported when the procedure is executed.</p><p>That&rsquo;s about it for today.</p><p>Cheers!</p><p>Lucas</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://lpains.net/posts/2021-12-29-deprecating-node-sass/><span class=title>« Prev Page</span><br><span>Removing node-sass from VueJS project</span></a>
<a class=next href=https://lpains.net/posts/2021-10-10-migrating-from-jekyll-to-hugo/><span class=title>Next Page »</span><br><span>Migrating from jekyll to Hugo</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Detecting changes on SQL Server Temporal Changes on twitter" href="https://twitter.com/intent/tweet/?text=Detecting%20changes%20on%20SQL%20Server%20Temporal%20Changes&url=https%3a%2f%2flpains.net%2fposts%2f2021-10-29-detect-changes-on-sql-temporal-tables%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Detecting changes on SQL Server Temporal Changes on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2flpains.net%2fposts%2f2021-10-29-detect-changes-on-sql-temporal-tables%2f&title=Detecting%20changes%20on%20SQL%20Server%20Temporal%20Changes&summary=Detecting%20changes%20on%20SQL%20Server%20Temporal%20Changes&source=https%3a%2f%2flpains.net%2fposts%2f2021-10-29-detect-changes-on-sql-temporal-tables%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Detecting changes on SQL Server Temporal Changes on reddit" href="https://reddit.com/submit?url=https%3a%2f%2flpains.net%2fposts%2f2021-10-29-detect-changes-on-sql-temporal-tables%2f&title=Detecting%20changes%20on%20SQL%20Server%20Temporal%20Changes"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Detecting changes on SQL Server Temporal Changes on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2flpains.net%2fposts%2f2021-10-29-detect-changes-on-sql-temporal-tables%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Detecting changes on SQL Server Temporal Changes on whatsapp" href="https://api.whatsapp.com/send?text=Detecting%20changes%20on%20SQL%20Server%20Temporal%20Changes%20-%20https%3a%2f%2flpains.net%2fposts%2f2021-10-29-detect-changes-on-sql-temporal-tables%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Detecting changes on SQL Server Temporal Changes on telegram" href="https://telegram.me/share/url?text=Detecting%20changes%20on%20SQL%20Server%20Temporal%20Changes&url=https%3a%2f%2flpains.net%2fposts%2f2021-10-29-detect-changes-on-sql-temporal-tables%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://lpains.net/>Pains.net</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>